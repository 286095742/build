From 33b021f99a794780edac7d74fe66a44a1b2718a6 Mon Sep 17 00:00:00 2001
From: Igor Pecovnik <igor.pecovnik@gmail.com>
Date: Tue, 10 Jan 2023 20:58:47 +0100
Subject: [PATCH] arm64:dts: sun50i-h6-tanix-tx6 Enable ethernet, eMMC and
 Xradio wireless

Signed-off-by: Igor Pecovnik <igor.pecovnik@gmail.com>
---
 .../dts/allwinner/sun50i-h6-tanix-tx6.dts     | 65 +++++++++++++++++++
 1 file changed, 65 insertions(+)

diff --git a/arch/arm64/boot/dts/allwinner/sun50i-h6-tanix-tx6.dts b/arch/arm64/boot/dts/allwinner/sun50i-h6-tanix-tx6.dts
index e91860a9e..b0d3815c6 100644
--- a/arch/arm64/boot/dts/allwinner/sun50i-h6-tanix-tx6.dts
+++ b/arch/arm64/boot/dts/allwinner/sun50i-h6-tanix-tx6.dts
@@ -13,6 +13,8 @@ / {
 	compatible = "oranth,tanix-tx6", "allwinner,sun50i-h6";
 
 	aliases {
+		ethernet0 = &emac;
+		ethernet1 = &xr819;		
 		serial0 = &uart0;
 	};
 
@@ -52,12 +54,28 @@ reg_vdd_cpu_gpu: regulator-vdd-cpu-gpu {
 		regulator-min-microvolt = <1135000>;
 		regulator-max-microvolt = <1135000>;
 	};
+	
+	wifi_pwrseq: wifi_pwrseq {
+		compatible = "mmc-pwrseq-simple";
+		clocks = <&rtc 1>;
+		clock-names = "ext_clock";
+		reset-gpios = <&r_pio 1 3 GPIO_ACTIVE_LOW>; /* PM3 */
+		post-power-on-delay-ms = <200>;
+	};	
 };
 
 &cpu0 {
 	cpu-supply = <&reg_vdd_cpu_gpu>;
 };
 
+&ac200_ephy {
+	status = "okay";
+};
+
+&ac200_pwm_clk {
+	status = "okay";
+};
+
 &de {
 	status = "okay";
 };
@@ -66,6 +84,14 @@ &dwc3 {
 	status = "okay";
 };
 
+&emac {
+	pinctrl-names = "default";
+	pinctrl-0 = <&ext_rmii_pins>;
+	phy-mode = "rmii";
+	phy-handle = <&ext_rmii_phy>;
+	status = "okay";
+};
+
 &ehci0 {
 	status = "okay";
 };
@@ -93,6 +119,17 @@ &i2s1 {
 	status = "okay";
 };
 
+&i2c3 {
+	status = "okay";
+};
+
+&mdio {
+	ext_rmii_phy: ethernet-phy@1 {
+		compatible = "ethernet-phy-ieee802.3-c22";
+		reg = <1>;
+	};
+};
+
 &mmc0 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&mmc0_pins>;
@@ -102,6 +139,30 @@ &mmc0 {
 	status = "okay";
 };
 
+&mmc1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&mmc1_pins>;
+	vmmc-supply = <&reg_vcc3v3>;
+	vqmmc-supply = <&reg_vcc1v8>;
+	mmc-pwrseq = <&wifi_pwrseq>;
+	bus-width = <4>;
+	non-removable;
+	status = "okay";
+
+       /*
+         * Explicitly define the sdio device, so that we can add an ethernet
+         * alias for it (which e.g. makes u-boot set a mac-address).
+         */
+        xr819: sdio_wifi@1 {
+                reg = <1>;
+		compatible = "xradio,xr819";
+		interrupt-parent = <&r_pio>;
+                local-mac-address = [dc 44 6d c0 ff ee];
+		interrupts = <1 0 IRQ_TYPE_EDGE_RISING>;	/* PM0 */
+		interrupt-names = "host-wake";
+        };
+};
+
 &mmc2 {
 	vmmc-supply = <&reg_vcc3v3>;
 	vqmmc-supply = <&reg_vcc1v8>;
@@ -126,6 +187,10 @@ &pio {
 	vcc-pg-supply = <&reg_vcc1v8>;
 };
 
+&pwm {
+	status = "okay";
+};
+
 &r_ir {
 	linux,rc-map-name = "rc-tanix-tx5max";
 	status = "okay";
-- 
Created with Armbian build tools https://github.com/armbian/build

